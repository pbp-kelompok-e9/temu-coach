{% load static %}
<!-- modal_edit_profile.html -->
<div>
  <div id="editProfileModal" class="hidden fixed inset-0 z-50 bg-black/60 flex justify-center items-center">
    <div class="bg-white rounded-xl shadow-lg w-11/12 max-w-lg flex flex-col max-h-[90vh] overflow-hidden">
      
      <!-- Header -->
      <div class="flex justify-between items-center border-b px-4 py-3 bg-gray-50">
        <h3 class="text-lg font-semibold text-gray-800">Edit Profil Coach</h3>
        <button onclick="hideEditProfileModal()" class="text-gray-500 hover:text-gray-700 text-xl font-bold">
          Ã—
        </button>
      </div>

      <!-- Body -->
      <form id="editProfileForm" method="POST" enctype="multipart/form-data" class="flex-1 overflow-y-auto px-5 py-4 space-y-4">
        {% csrf_token %}
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nama</label>
          <input type="text" id="name" name="name" value="{{ coach.name }}" required
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="age" class="block text-sm font-medium text-gray-700 mb-1">Usia</label>
          <input type="number" id="age" name="age" value="{{ coach.age }}" required
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="citizenship" class="block text-sm font-medium text-gray-700 mb-1">Kewarganegaraan</label>
          <input type="text" id="citizenship" name="citizenship" value="{{ coach.citizenship }}" required
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="club" class="block text-sm font-medium text-gray-700 mb-1">Klub</label>
          <input type="text" id="club" name="club" value="{{ coach.club }}"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="license" class="block text-sm font-medium text-gray-700 mb-1">Lisensi</label>
          <input type="text" id="license" name="license" value="{{ coach.license }}"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="preffered_formation" class="block text-sm font-medium text-gray-700 mb-1">Formasi Favorit</label>
          <input type="text" id="preffered_formation" name="preffered_formation" value="{{ coach.preffered_formation }}"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="average_term_as_coach" class="block text-sm font-medium text-gray-700 mb-1">Rata-rata Masa Melatih (tahun)</label>
          <input type="number" step="0.1" id="average_term_as_coach" name="average_term_as_coach" value="{{ coach.average_term_as_coach }}"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="rate_per_session" class="block text-sm font-medium text-gray-700 mb-1">Tarif per Sesi</label>
          <input type="number" step="0.01" id="rate_per_session" name="rate_per_session" value="{{ coach.rate_per_session }}"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
          <textarea id="description" name="description" rows="3"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">{{ coach.description }}</textarea>
        </div>

        <div>
          <label for="foto" class="block text-sm font-medium text-gray-700 mb-1">Foto</label>
          <input type="file" id="foto" name="foto" accept="image/*"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
        </div>
      </form>

      <!-- Footer -->
      <div class="flex justify-end gap-3 border-t px-5 py-3 bg-gray-50">
        <button onclick="hideEditProfileModal()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold px-4 py-2 rounded-lg transition">
          Batal
        </button>
        <button type="submit" form="editProfileForm"
                class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg transition">
          Simpan
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const editModal = document.getElementById('editProfileModal');

  function showEditProfileModal() {
    editModal.classList.remove('hidden');
  }

  function hideEditProfileModal() {
    editModal.classList.add('hidden');
  }

  window.addEventListener('click', (e) => {
    if (e.target === editModal) hideEditProfileModal();
  });

  document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    try {
      const response = await fetch("{% url 'update_coach_profile' %}", {
        method: "POST",
        headers: { 'X-Requested-With': 'XMLHttpRequest' },
        body: formData
      });
      if (!response.ok) throw new Error('Gagal memperbarui profil');
      showToast("Berhasil!", "Profil berhasil diperbarui ðŸŽ‰", "success");
      hideEditProfileModal();

      setTimeout(() => location.reload(), 1500);

    } catch (err) {
      console.error(err);
      showToast("Error", "Terjadi kesalahan saat menyimpan profil.", "error");
    }
  });
  
</script>
{% include 'toast.html' %}
