{% extends 'base.html' %}

{% block title %}Katalog Coach{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">

<div class="max-w-[1100px] mx-auto px-8 py-4 font-[Plus Jakarta Sans] bg-white text-black font-normal">
    <div class="text-left mt-8 mb-4">
        <h1 class="text-[4.375rem] font-bold text-[#003E85] m-0">Temukan Coach Terbaik Anda</h1>
        <p class="text-[2.625rem] text-[#003E85] mt-2 font-semibold">Jelajahi daftar pelatih profesional kami.</p>
    </div>

    <form method="GET" action="{% url 'show_catalog' %}" class="mb-8" id="controls-form">
        <div class="flex gap-2 mb-6">
            <input type="text" name="q" value="{{ search_query }}" placeholder="Cari nama coach..." class="flex-grow px-4 py-3 text-base border-[3px] border-[#B0B0B0] rounded-[10px] font-normal placeholder:text-gray-500">
            <button type="submit" class="px-6 py-3 text-base font-semibold bg-[#DE3400] text-white border-[3px] border-[#B0B0B0] rounded-[10px] cursor-pointer">Cari</button>
        </div>

        <div class="flex flex-wrap items-center gap-3">
            <label for="sort-select" class="text-base text-[#003E85] font-semibold">Urutkan berdasarkan:</label>
            <select name="sort" id="sort-select" class="appearance-none bg-[#DE3400] text-white px-4 pr-10 py-2 rounded font-semibold text-sm cursor-pointer bg-no-repeat bg-right-[0.75rem] bg-[length:12px_12px]" style="background-image:url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22white%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M1.646%204.646a.5.5%200%200%201%20.708%200L8%2010.293l5.646-5.647a.5.5%200%200%201%20.708.708l-6%206a.5.5%200%200%201-.708%200l-6-6a.5.5%200%200%201%200-.708z%22%2F%3E%3C%2Fsvg%3E');">
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name Coach (A-Z)</option>
                <option value="rate_asc" {% if sort_by == 'rate_asc' %}selected{% endif %}>Harga (Termurah)</option>
                <option value="rate_desc" {% if sort_by == 'rate_desc' %}selected{% endif %}>Harga (Termahal)</option>
            </select>

            <label for="country-select" class="text-base text-[#003E85] font-semibold">Filter:</label>
            <select name="country" id="country-select" class="appearance-none bg-[#DE3400] text-white px-4 pr-10 py-2 rounded font-semibold text-sm cursor-pointer bg-no-repeat bg-right-[0.75rem] bg-[length:12px_12px]" style="background-image:url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22white%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M1.646%204.646a.5.5%200%200%201%20.708%200L8%2010.293l5.646-5.647a.5.5%200%200%201%20.708.708l-6%206a.5.5%200%200%201-.708%200l-6-6a.5.5%200%200%201%200-.708z%22%2F%3E%3C%2Fsvg%3E');">
                <option value="">Negara</option>
                {% for country in countries_list %}
                    <option value="{{ country }}" {% if country == country_filter %}selected{% endif %}>{{ country }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <div id="coach-list-container">
        {% include 'coaches_book_catalog/coach_list_partial.html' %}
    </div>

    <section class="text-left mt-16 pt-8">
        <h2 class="text-[2rem] font-bold text-[#003E85] mb-8">How TemuCoach Works</h2>
        <div class="grid grid-cols-3 gap-6 text-left max-md:grid-cols-1">
            <div class="bg-white border border-[#E0E0E0] rounded-lg p-6 text-center">
                <div class="flex justify-center items-center w-[60px] h-[60px] bg-[#ffe5dd] rounded-full shadow mx-auto mb-4">
                    <i class="fas fa-search text-[2.5rem] text-[#DE3400]"></i>
                </div>
                <h3 class="text-[#003E85] text-xl font-bold mb-2">Browse</h3>
                <p class="text-sm text-[#003E85] leading-[1.5]">Temukan dan bandingkan ratusan pelatih profesional dari berbagai negara dan keahlian.</p>
            </div>
            <div class="bg-white border border-[#E0E0E0] rounded-lg p-6 text-center">
                <div class="flex justify-center items-center w-[60px] h-[60px] bg-[#ffe5dd] rounded-full shadow mx-auto mb-4">
                    <i class="fas fa-calendar-check text-[2.5rem] text-[#DE3400]"></i>
                </div>
                <h3 class="text-[#003E85] text-xl font-bold mb-2">Book</h3>
                <p class="text-sm text-[#003E85] leading-[1.5]">Lihat ketersediaan jadwal, pilih waktu yang paling sesuai, dan pesan sesi Anda secara instan.</p>
            </div>
            <div class="bg-white border border-[#E0E0E0] rounded-lg p-6 text-center">
                <div class="flex justify-center items-center w-[60px] h-[60px] bg-[#ffe5dd] rounded-full shadow mx-auto mb-4">
                    <i class="fas fa-dumbbell text-[2.5rem] text-[#DE3400]"></i>
                </div>
                <h3 class="text-[#003E85] text-xl font-bold mb-2">Train</h3>
                <p class="text-sm text-[#003E85] leading-[1.5]">Mulai sesi latihan Anda dan dapatkan bimbingan ahli untuk mencapai tujuan pribadi atau profesional Anda.</p>
            </div>
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('controls-form');
        const container = document.getElementById('coach-list-container');
        const searchInput = form.querySelector('input[name="q"]');
        const sortSelect = document.getElementById('sort-select');
        const countrySelect = document.getElementById('country-select');

        function fetchAndUpdate(url) {
            fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(response => response.text())
            .then(html => {
                container.innerHTML = html;
                window.history.pushState({path: url}, '', url);
            })
            .catch(error => console.error('Error fetching content:', error));
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            const params = new URLSearchParams(formData);
            const url = `${form.action}?${params.toString()}`;
            fetchAndUpdate(url);
        });

        function handleFilterChange() {
            const params = new URLSearchParams({
                'q': searchInput.value,
                'sort': sortSelect.value,
                'country': countrySelect.value
            });
            const url = `${form.action}?${params.toString()}`;
            fetchAndUpdate(url);
        }
        
        sortSelect.addEventListener('change', handleFilterChange);
        countrySelect.addEventListener('change', handleFilterChange);

        container.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && e.target.closest('.pagination')) {
                e.preventDefault();
                const url = e.target.href;
                fetchAndUpdate(url);
            }
        });
        
        window.addEventListener('popstate', function(e) {
            if (e.state && e.state.path) {
                fetchAndUpdate(e.state.path);
            } else {
                fetchAndUpdate(location.pathname + location.search);
            }
        });
    });
</script>
{% endblock %}