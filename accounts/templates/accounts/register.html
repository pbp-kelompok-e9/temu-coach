{% extends 'base.html' %}
{% load static %}

{% block title %}Register{% endblock %}

{% block content_style %}
<style>
    body { padding-top: 0 !important; }
    .bg-gradient-custom::before { content:""; position:absolute; inset:0; z-index:1; }
</style>
{% endblock %}

{% block navbar_content %}{% endblock %}
{% block chat_widget_content %}{% endblock %}

{% block content %}
<div class="min-h-screen flex items-stretch text-white">

  <!-- LEFT: hero tanpa link login -->
  <div class="relative hidden lg:flex lg:w-4/5 items-center justify-start bg-cover bg-center bg-gradient-custom"
       style="background-image: url('{% static 'images/football-background.png' %}');">
      <div class="z-10 p-12 xl:p-16 max-w-lg relative ml-10 xl:ml-16">
          <h1 class="text-4xl xl:text-5xl font-bold mb-6 leading-tight">
              Join the Community,<br> Achieve Your Goals
          </h1>
      </div>
  </div>

  <!-- RIGHT: form -->
  <div class="lg:w-2/5 w-full flex items-center justify-center text-center md:px-12 px-6 z-10 bg-white text-gray-800">
    <div class="w-full py-6 z-20 max-w-md">

      <div class="flex items-center justify-center mb-8">
        <img src="{% static 'images/logo.png' %}" alt="TemuCoach Logo" class="w-12 h-12 mr-3">
        <span class="text-3xl font-bold text-[#003E85]">TemuCoach</span>
      </div>
      <h1 class="text-3xl font-semibold mb-8 text-gray-700">Create Account</h1>

      {% if user_form.errors or coach_form.errors and not messages %}
        <div class="mb-4 p-3 rounded bg-red-100 text-red-700 text-sm" role="alert">
          Please correct the errors below.
        </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data" id="register-form" class="space-y-6 text-left">
        {% csrf_token %}

        <!-- a) Daftar sebagai (dipindah ke paling atas) -->
        <div class="text-left">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            {{ user_form.user_type.label }} {% if user_form.user_type.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          <div class="flex gap-6 mt-2" id="user_type_group">
            {% for radio in user_form.user_type %}
              <label class="inline-flex items-center text-gray-700">
                {{ radio.tag }}
                <span class="ml-2">{{ radio.choice_label }}</span>
              </label>
            {% endfor %}
          </div>
          {% if user_form.user_type.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.user_type.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- b) First name (styling sama seperti Username) -->
        <div class="relative">
          <input
            type="text" name="{{ user_form.first_name.name }}" id="{{ user_form.first_name.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="First name" {% if user_form.first_name.field.required %}required{% endif %}>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 pointer-events-none">
            <i class="fas fa-user text-lg"></i>
          </span>
          {% if user_form.first_name.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.first_name.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- c) Last name (styling sama seperti Username) -->
        <div class="relative">
          <input
            type="text" name="{{ user_form.last_name.name }}" id="{{ user_form.last_name.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="Last name" {% if user_form.last_name.field.required %}required{% endif %}>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 pointer-events-none">
            <i class="fas fa-user text-lg"></i>
          </span>
          {% if user_form.last_name.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.last_name.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- d) Username -->
        <div class="relative">
          <input
            type="text" name="{{ user_form.username.name }}" id="{{ user_form.username.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="Username" {% if user_form.username.field.required %}required{% endif %} autofocus>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 pointer-events-none">
            <i class="fas fa-user text-lg"></i>
          </span>
          {% if user_form.username.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.username.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- e) Email -->
        <div class="relative">
          <input
            type="email" name="{{ user_form.email.name }}" id="{{ user_form.email.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="Email" {% if user_form.email.field.required %}required{% endif %}>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 pointer-events-none">
            <i class="fas fa-envelope text-lg"></i>
          </span>
          {% if user_form.email.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.email.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- f) Password -->
        <div class="relative">
          <input
            type="password" name="{{ user_form.password1.name }}" id="{{ user_form.password1.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="{{ user_form.password1.label }}" {% if user_form.password1.field.required %}required{% endif %}>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer text-gray-400 hover:text-gray-600 toggle-password">
            <i class="fas fa-eye-slash text-lg"></i>
          </span>
          {% if user_form.password1.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.password1.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- g) Confirmation password -->
        <div class="relative">
          <input
            type="password" name="{{ user_form.password2.name }}" id="{{ user_form.password2.id_for_label }}"
            class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 pr-12 text-lg"
            placeholder="{{ user_form.password2.label }}" {% if user_form.password2.field.required %}required{% endif %}>
          <span class="absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer text-gray-400 hover:text-gray-600 toggle-password">
            <i class="fas fa-eye-slash text-lg"></i>
          </span>
          {% if user_form.password2.errors %}
            <ul class="text-red-600 text-sm mt-1">
              {% for error in user_form.password2.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
          {% endif %}
        </div>

        <!-- Coach extra fields (tetap seperti sebelumnya) -->
        <div id="coach-fields-section" class="hidden space-y-6">
          <h2 class="text-xl font-semibold text-gray-700 mb-4 mt-8">Coach Details</h2>
          {% for field in coach_form %}
            <div class="text-left">
              <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                {{ field.label }} {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
              </label>

              {% if field.name == 'bio' %}
                <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" rows="4"
                  class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 text-lg"
                  placeholder="Bio"></textarea>
              {% elif field.name == 'spesialisasi' %}
                <select name="{{ field.name }}" id="{{ field.id_for_label }}"
                  class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent text-gray-900 text-lg">
                  {{ field }}
                </select>
              {% elif field.name == 'foto' %}
                {{ field }}
              {% else %}
                <input type="text" name="{{ field.name }}" id="{{ field.id_for_label }}"
                  class="block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#6366F1] focus:border-transparent placeholder-gray-500 text-gray-900 text-lg"
                  placeholder="{{ field.label }}">
              {% endif %}

              {% if field.errors %}
                <ul class="text-red-600 text-sm mt-1">
                  {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <button type="submit"
          class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200 text-lg">
          Register
        </button>
      </form>

      <!-- Teks baru dipindah ke bawah tombol -->
      <div class="mt-4 text-sm text-center">
        <p class="text-gray-600">
          Have an account already?
          <a href="{% url 'login' %}" class="font-semibold text-[#003E85] hover:text-blue-700">Sign In</a>
        </p>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block content_script %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Tampilkan/semmbunyikan coach fields
  const userTypeRadios = document.querySelectorAll('#user_type_group input[name="user_type"]');
  const coachFields = document.getElementById('coach-fields-section');
  const coachFormInputs = coachFields.querySelectorAll('input, textarea, select');
  const initialRequiredStatus = new Map();
  coachFormInputs.forEach(input => initialRequiredStatus.set(input, input.required));

  function toggleCoachFields() {
    const selected = document.querySelector('#user_type_group input[name="user_type"]:checked');
    if (selected && selected.value === 'coach') {
      coachFields.classList.remove('hidden');
      coachFormInputs.forEach(input => input.required = initialRequiredStatus.get(input));
      const foto = coachFields.querySelector('input[type="file"][name="foto"]');
      if (foto) foto.required = false; // file opsional
    } else {
      coachFields.classList.add('hidden');
      coachFormInputs.forEach(input => input.required = false);
    }
  }
  toggleCoachFields();
  userTypeRadios.forEach(radio => radio.addEventListener('change', toggleCoachFields));

  // Toggle password1 & password2
  document.querySelectorAll('.toggle-password').forEach(btn => {
    btn.addEventListener('click', function () {
      const input = this.parentElement.querySelector('input');
      const icon  = this.querySelector('i');
      if (!input) return;
      const show = input.type === 'password';
      input.type = show ? 'text' : 'password';
      icon.classList.toggle('fa-eye', show);
      icon.classList.toggle('fa-eye-slash', !show);
    });
  });
});
</script>
{% endblock %}
