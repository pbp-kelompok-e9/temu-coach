{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content_style %}
<style>
    .auth-container { max-width: 600px; margin: 3rem auto; padding: 2rem; border: 1px solid #ddd; border-radius: 8px; background: white;}
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; font-weight: 600; }
    input[type="text"], input[type="email"], input[type="password"], input[type="number"], input[type="file"], textarea, select {
        width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
    }
    .radio-group label { display: inline-block; margin-right: 1rem; font-weight: 400; }
    .submit-btn { padding: 0.7rem 1.5rem; background-color: #DE3400; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .coach-fields { border-top: 1px solid #eee; margin-top: 1.5rem; padding-top: 1.5rem; }
    /* Style untuk pesan error/sukses */
    .alert { padding: 10px; margin-bottom: 15px; border-radius: 4px; }
    .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .errorlist { list-style: none; padding: 0; color: red; font-size: 0.8em; margin-top: 5px; }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <h1>Buat Akun Baru</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <form method="post" enctype="multipart/form-data" id="register-form">
        {% csrf_token %}

        <h2>Data User</h2>
        {% for field in user_form %}
            <div class="form-group">
                {{ field.label_tag }}
                {% if field.name == 'user_type' %}
                    <div class="radio-group" id="user_type_group"> 
                        {% for radio in field %}
                            <label>
                                {{ radio.tag }} {{ radio.choice_label }}
                            </label>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ field }}
                {% endif %}
                {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
                {{ field.errors }}
            </div>
        {% endfor %}

        <div id="coach-fields-section" class="coach-fields" style="display: none;">
             <h2>Detail Coach</h2>
             {% for field in coach_form %}
                 <div class="form-group">
                     {{ field.label_tag }}
                     {{ field }}
                     {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
                     {{ field.errors }}
                 </div>
             {% endfor %}
        </div>

        <button type="submit" class="submit-btn">Register</button>
    </form>
     <p>Sudah punya akun? <a href="{% url 'login' %}">Login di sini</a></p> 
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const userTypeRadios = document.querySelectorAll('#user_type_group input[name="user_type"]');
        const coachFields = document.getElementById('coach-fields-section');
        const coachFormInputs = coachFields.querySelectorAll('input, textarea, select');

        function toggleCoachFields() {
            const selectedType = document.querySelector('#user_type_group input[name="user_type"]:checked');
            if (selectedType && selectedType.value === 'coach') {
                coachFields.style.display = 'block';
                coachFormInputs.forEach(input => input.required = true);
                const fotoInput = coachFields.querySelector('input[type="file"]');
                if (fotoInput) fotoInput.required = false; 
            } else {
                coachFields.style.display = 'none';
                 coachFormInputs.forEach(input => input.required = false);
            }
        }

        toggleCoachFields(); 
        userTypeRadios.forEach(radio => radio.addEventListener('change', toggleCoachFields));
    });
</script>
{% endblock %}